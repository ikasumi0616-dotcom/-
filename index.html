<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Music Switcher Perfect</title>
    <style>
        :root { 
            --accent: #ffffff; 
            --bg: #000; 
            --text: #fff; 
            --card: #1c1c1e; 
            --radius: 8px; 
            --switcher-bg: #fff; 
            --switcher-text: #000;
            --bar-color: #ffffff;
        }
        
        body.line-mode { 
            --accent: #00c300; 
            --bg: #ffffff; 
            --text: #000; 
            --card: #f8f8f8; 
            --radius: 50%; 
            --switcher-bg: #000; 
            --switcher-text: #fff;
            --bar-color: #000000;
        }

        body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; overflow: hidden; transition: background 0.3s; -webkit-tap-highlight-color: transparent; }

        /* スタイル切り替えボタン（右端へ） */
        #style-switcher {
            position: fixed; right: 5px; top: 50%; transform: translateY(-50%);
            width: 35px; height: 35px; background: var(--switcher-bg); color: var(--switcher-text);
            border-radius: 50% 0 0 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; z-index: 1000; box-shadow: -2px 2px 10px rgba(0,0,0,0.3); cursor: pointer; transition: 0.3s;
        }

        #library-screen { padding: 20px; padding-top: 50px; height: 100vh; overflow-y: auto; box-sizing: border-box; padding-bottom: 150px; }
        h1 { font-size: 34px; font-weight: 800; margin-bottom: 20px; }
        .line-mode h1 { text-align: center; font-size: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }

        .song-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 0.5px solid rgba(128,128,128,0.2); }
        .song-item img { width: 55px; height: 55px; border-radius: var(--radius); margin-right: 15px; transition: 0.3s; }

        /* ミニプレイヤー */
        #mini-player { 
            position: fixed; bottom: 10px; left: 10px; right: 10px; height: 64px; 
            background: var(--card); backdrop-filter: blur(20px); border-radius: 12px; 
            display: flex; align-items: center; padding: 0 15px; z-index: 200; 
            transform: translateY(120px); transition: 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            overflow: hidden;
        }
        .line-mode #mini-player { bottom: 0; left: 0; right: 0; border-radius: 0; border-top: 1px solid #eee; }
        #mini-player.visible { transform: translateY(0); }
        
        /* ミニプレイヤーの進捗線 */
        #mini-progress { position: absolute; top: 0; left: 0; height: 2px; background: var(--bar-color); width: 0%; transition: width 0.1s linear; }

        #mini-player img { width: 44px; height: 44px; border-radius: 4px; margin-right: 12px; }
        .m-play-btn { font-size: 28px; background: none; border: none; color: var(--text); }
        .line-mode .m-play-btn { color: var(--accent); }

        /* メインプレイヤー */
        #player-screen { 
            position: fixed; bottom: 0; left: 0; width: 100%; height: 94%; 
            background: var(--card); display: flex; flex-direction: column; align-items: center; 
            border-radius: 30px 30px 0 0; transform: translateY(100%); transition: 0.4s cubic-bezier(0.25, 1, 0.5, 1); z-index: 300;
        }
        .line-mode #player-screen { border-radius: 0; height: 100%; }
        .active #player-screen { transform: translateY(0); }
        .handle { width: 36px; height: 5px; background: rgba(128,128,128,0.3); border-radius: 5px; margin: 15px 0 40px; }
        
        .p-jacket { width: 85%; aspect-ratio: 1/1; border-radius: 15px; transition: 0.6s cubic-bezier(0.23, 1, 0.32, 1); box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .p-jacket.paused { transform: scale(0.8); filter: brightness(0.6); }
        .line-mode .p-jacket.paused { transform: translateY(20px); filter: grayscale(0.8) opacity(0.5); }

        .p-info { width: 85%; margin-top: 40px; }
        #p-artist { font-size: 20px; color: var(--text); opacity: 0.7; }
        .line-mode #p-artist { color: var(--accent); opacity: 1; }

        /* シークバーエリア */
        .seek-area { width: 85%; margin-top: 30px; }
        .seek-container { width: 100%; height: 4px; background: rgba(128,128,128,0.2); border-radius: 2px; position: relative; }
        .seek-bar-fill { position: absolute; top: 0; left: 0; height: 100%; background: var(--bar-color); border-radius: 2px; width: 0%; }
        #p-seek-range { -webkit-appearance: none; width: 100%; background: transparent; position: absolute; top: -10px; height: 24px; outline: none; margin: 0; z-index: 2; }
        
        .time-box { display: flex; justify-content: space-between; width: 100%; font-size: 12px; margin-top: 8px; color: rgba(128,128,128,0.8); }

        .play-btn-main { background: none; border: none; color: var(--text); font-size: 80px; margin-top: 20px; }
        .line-mode .play-btn-main { color: var(--accent); }
    </style>
</head>
<body id="body">

<div id="style-switcher" onclick="toggleStyle()">L</div>

<div id="library-screen">
    <h1 id="lib-title">ライブラリ</h1>
    <div id="song-list"></div>
</div>

<div id="mini-player" onclick="showFullPlayer()">
    <div id="mini-progress"></div>
    <img src="" id="m-jacket">
    <div style="flex:1; overflow:hidden;">
        <div id="m-title" style="font-weight:600; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"></div>
        <div id="m-artist" style="font-size:12px; color:#8e8e93;"></div>
    </div>
    <button class="m-play-btn" onclick="event.stopPropagation(); toggleAudio();" id="m-playBtn">▶</button>
</div>

<div id="player-overlay" onclick="closePlayer()">
    <div id="player-screen" onclick="event.stopPropagation()">
        <div class="handle" onclick="closePlayer()"></div>
        <img src="" id="p-jacket" class="p-jacket paused">
        
        <div class="p-info">
            <div id="p-title" style="font-size:24px; font-weight:700;"></div>
            <div id="p-artist"></div>
        </div>

        <div class="seek-area">
            <div class="seek-container">
                <div id="p-fill" class="seek-bar-fill"></div>
                <input type="range" id="p-seek-range" value="0" step="0.1">
            </div>
            <div class="time-box">
                <span id="time-current">0:00</span>
                <span id="time-total">0:00</span>
            </div>
        </div>

        <button class="play-btn-main" onclick="toggleAudio()" id="p-playBtn">▶</button>
    </div>
</div>

<script>
    const songs = [
        {title:'水色侵略', artist:'ナユタン星人', img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQFSIg4JHtAksIoZjpoCoiHVxorSrSfVItpfxMThqFO7ptiPkgRYI-qq1Y&s=10', src:'水色侵略.m4a'},
        {title:'ただ君に晴れ', artist:'ヨルシカ', img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQoirt4O4EZaKDVV-OZBHIxqnCemfKkk4IwIDJ28sS7iiDQmdZRU-Yg4B8h&s=10', src:'ただ君に晴れ.m4a'},
        {title:'正しくなれない', artist:'ずっと真夜中でいいのに。', img:'https://i.kfs.io/album/global/96695506,1v1/fit/500x500.jpg', src:'正しくなれない.m4a'},
        {title:'フォニイ', artist:'ツミキ', img:'https://i1.sndcdn.com/artworks-tT9a73bRyGkxGhyM-gD3vjA-t500x500.jpg', src:'フォニイ.m4a'},
        {title:'エゴロック', artist:'すりぃ', img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnUm5J7ccLutsqE-OElu_8yzJZXClKv98UWXiNVBHv7AtydVwZtMBLAdY&s=10', src:'エゴロック.m4a'},
        {title:'恋風', artist:'幾田りら', img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSR1CTX1feIVp0pqB5dsukeZg9TLh9SfxPZKrT779M9MlIjL4swLFbMt2o&s=10', src:'恋風.m4a'},
        {title:'怪獣の花唄', artist:'Vaundy', img:'https://i.ytimg.com/vi/QPmwuAe2wBA/maxresdefault.jpg', src:'怪獣の花唄.m4a'},
        {title:'プロポーズ', artist:'内緒のピアス', img:'https://is1-ssl.mzstatic.com/image/thumb/Music116/v4/6b/9d/fd/6b9dfd2d-30f5-5460-1502-3c82e668078e/5063414104273_cover.jpg/600x600bb.jpg', src:'プロポーズ.m4a'}
    ];

    const audio = new Audio();
    let lagTimer = null;

    const songList = document.getElementById('song-list');
    songs.forEach((s, i) => {
        songList.innerHTML += `<div class="song-item" onclick="playSong(${i})">
            <img src="${s.img}">
            <div class="song-info"><div class="title">${s.title}</div><div class="artist">${s.artist}</div></div>
        </div>`;
    });

    function toggleStyle() {
        const isLine = document.getElementById('body').classList.toggle('line-mode');
        const btn = document.getElementById('style-switcher');
        const title = document.getElementById('lib-title');
        btn.innerText = isLine ? 'A' : 'L';
        title.innerText = isLine ? 'トップソング' : 'ライブラリ';
    }

    function playSong(i) {
        const s = songs[i];
        audio.src = s.src;
        document.getElementById('m-title').innerText = s.title;
        document.getElementById('m-artist').innerText = s.artist;
        document.getElementById('m-jacket').src = s.img;
        document.getElementById('p-title').innerText = s.title;
        document.getElementById('p-artist').innerText = s.artist;
        document.getElementById('p-jacket').src = s.img;
        document.getElementById('mini-player').classList.add('visible');
        triggerAction('play');
    }

    function toggleAudio() {
        if (audio.src) triggerAction(audio.paused ? 'play' : 'pause');
    }

    function triggerAction(type) {
        if (lagTimer) clearTimeout(lagTimer);
        lagTimer = setTimeout(() => {
            type === 'play' ? audio.play() : audio.pause();
            const icon = !audio.paused ? 'II' : '▶';
            document.getElementById('m-playBtn').innerText = icon;
            document.getElementById('p-playBtn').innerText = icon;
            document.getElementById('p-jacket').classList.toggle('paused', audio.paused);
        }, type === 'play' ? 1000 : 700);
    }

    audio.addEventListener('timeupdate', () => {
        const ratio = (audio.currentTime / audio.duration) * 100 || 0;
        document.getElementById('p-fill').style.width = ratio + '%';
        document.getElementById('mini-progress').style.width = ratio + '%';
        document.getElementById('p-seek-range').value = ratio;
        document.getElementById('time-current').innerText = formatTime(audio.currentTime);
        document.getElementById('time-total').innerText = formatTime(audio.duration);
    });

    function formatTime(s) {
        if (!s || isNaN(s)) return "0:00";
        const m = Math.floor(s / 60), ss = Math.floor(s % 60);
        return `${m}:${ss < 10 ? '0' : ''}${ss}`;
    }

    document.getElementById('p-seek-range').oninput = function() {
        if (audio.duration) audio.currentTime = (this.value / 100) * audio.duration;
    };

    function showFullPlayer() { document.getElementById('player-overlay').classList.add('active'); }
    function closePlayer() { document.getElementById('player-overlay').classList.remove('active'); }

    let startY = 0;
    const pScreen = document.getElementById('player-screen');
    pScreen.ontouchstart = (e) => startY = e.touches[0].clientY;
    pScreen.ontouchmove = (e) => {
        let moveY = e.touches[0].clientY - startY;
        if (moveY > 0) pScreen.style.transform = `translateY(${moveY}px)`;
    };
    pScreen.ontouchend = (e) => {
        pScreen.style.transform = '';
        if (e.changedTouches[0].clientY - startY > 100) closePlayer();
    };
</script>
</body>
</html>
